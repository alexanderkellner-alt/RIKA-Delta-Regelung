blueprint:
  name: RIKA â€“ Delta-Temperaturregelung (Wohnbereich)
  description: >
    Regelt automatisch die Heizleistung des RIKA-Ofens basierend auf der Raumtemperatur,
    Solltemperatur, Hysterese und Ofenstatus.
  domain: automation

  input:
    heizleistung:
      name: Heizleistung
      default: number.wohnbereich_heizleistung_begrenzt
      selector:
        entity:
          domain: number

    ofen_schalter:
      name: Ofen Ein/Aus
      default: switch.wohnbereich_on_off
      selector:
        entity:
          domain: switch

    heizstatus:
      name: Ofen heizt (Status)
      default: sensor.wohnbereich_stove_burning
      selector:
        entity:
          domain: sensor

    berechneter_sensor:
      name: Berechnete Heizleistung
      default: sensor.wohnbereich_heizleistung_berechnet
      selector:
        entity:
          domain: sensor

trigger:
  - platform: state
    entity_id: !input berechneter_sensor

  - platform: state
    entity_id: !input ofen_schalter

condition:
  - condition: state
    entity_id: !input ofen_schalter
    state: "on"

  - condition: template
    value_template: >
      {{ states('!input heizstatus') | lower == 'true' }}

action:
  - service: number.set_value
    target:
      entity_id: !input heizleistung
    data:
      value: "{{ states('!input berechneter_sensor') | float }}"
