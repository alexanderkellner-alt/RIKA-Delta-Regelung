blueprint:
  name: RIKA – Delta-Temperaturregelung (Wohnbereich)
  description: >
    Automatische Heizleistungsregelung basierend auf Raumtemperatur und Sollwert.
    Es wird nur geprüft, ob der Ofen eingeschaltet ist.
  domain: automation

  input:
    heizleistung:
      name: Heizleistung
      default: number.wohnbereich_heizleistung_begrenzt
      selector:
        entity:
          domain: number

    ofen_schalter:
      name: Ofen Ein/Aus
      default: switch.wohnbereich_on_off
      selector:
        entity:
          domain: switch

    berechneter_sensor:
      name: Berechnete Heizleistung
      default: sensor.wohnbereich_heizleistung_berechnet
      selector:
        entity:
          domain: sensor

trigger:
  # 1️⃣ Immer wenn sich der berechnete Sensor ändert
  - platform: state
    entity_id: !input berechneter_sensor

  # 2️⃣ Wenn der Ofen ein-/ausgeschaltet wird
  - platform: state
    entity_id: !input ofen_schalter

  # 3️⃣ Zeittrigger: alle 1 Minute prüfen
  - platform: time_pattern
    minutes: "/1"

condition:
  # Nur prüfen, ob der Ofen eingeschaltet ist
  - condition: state
    entity_id: !input ofen_schalter
    state: "on"

action:
  - service: number.set_value
    target:
      entity_id: !input heizleistung
    data:
      value: "{{ states('!input berechneter_sensor') | float }}"
